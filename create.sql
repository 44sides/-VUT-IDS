-- drop tables
DROP TABLE doporuceni CASCADE CONSTRAINTS;
DROP TABLE recenze CASCADE CONSTRAINTS;
DROP TABLE obdobi CASCADE CONSTRAINTS;
DROP TABLE rezervace CASCADE CONSTRAINTS;
DROP TABLE pobyt CASCADE CONSTRAINTS;
DROP TABLE host CASCADE CONSTRAINTS;
DROP TABLE uzivatel CASCADE CONSTRAINTS;
DROP TABLE pronajimatel CASCADE CONSTRAINTS;
DROP TABLE ubytovani CASCADE CONSTRAINTS;

-- create tables
CREATE TABLE uzivatel (
	ucet_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	jmeno VARCHAR(255) NOT NULL,
	projemni VARCHAR(255) NOT NULL,
	RC INT NOT NULL,
	adresa VARCHAR(255) NOT NULL,
	telefon INT NOT NULL
);

CREATE TABLE host (
	uzivatel INT REFERENCES uzivatel PRIMARY KEY, 
	datum_registrace DATE NOT NULL,
	pocet_ubytovani INT,
	overeny_uzivatel VARCHAR(3) NOT NULL	
);

CREATE TABLE pronajimatel(
	uzivatel INT REFERENCES uzivatel PRIMARY KEY,
	informace VARCHAR(255) ,
	reputace VARCHAR(255) NOT NULL,
	cas_odezvy VARCHAR(255)
);

CREATE TABLE ubytovani (
	ubytovani_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	pronajimatel,
	typ VARCHAR(255) NOT NULL,
	cena_za_noc INT, 
	typ_slevy VARCHAR(255),
	zeme VARCHAR(255) NOT NULL,
	mesto VARCHAR(255) NOT NULL,
	popis VARCHAR(255),
	vybaveni VARCHAR(255),
	pravidla VARCHAR(255),
	bezpecnostni_prvky VARCHAR(255),
	FOREIGN KEY (pronajimatel) REFERENCES pronajimatel
);

CREATE TABLE rezervace (
	rezervace_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	host REFERENCES host,
	ubytovani REFERENCES ubytovani,
	suma INT NOT NULL,
	datum DATE NOT NULL	
);

CREATE TABLE doporuceni (
	doporuceni_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	ubytovani,
	pamatky VARCHAR(255),
	aktivity VARCHAR(255),
	restaurace VARCHAR(255),
	autopujcovny VARCHAR(255),
	FOREIGN KEY( ubytovani ) REFERENCES ubytovani(ubytovani_id)
);

CREATE TABLE pobyt ( --weak
	pobyt_num INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	host REFERENCES host,
	ubytovani REFERENCES ubytovani,
	datum_od DATE NOT NULL,
	datum_do DATE NOT NULL,
	platba VARCHAR(255),
	uskutocnil_se VARCHAR(3)
);

CREATE TABLE recenze ( --weak
	recenze_num INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	ubytovani REFERENCES ubytovani,
	host REFERENCES host,
	komentar VARCHAR(255),
	hodnoceni INT
);

CREATE TABLE obdobi (
	id int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) NOT NULL PRIMARY KEY,
	datum_od DATE not NULL,
	datum_do DATE not NULL,
	sleva int,
	rezervace_num NOT NULL,
  	FOREIGN KEY (rezervace_num) REFERENCES rezervace(rezervace_id)  	
);


-- clear tables to prevent duplicate values
DELETE FROM uzivatel ;
DELETE FROM host ;
DELETE FROM pronajimatel ;
DELETE FROM ubytovani;
DELETE FROM rezervace;
DELETE FROM obdobi;
DELETE FROM doporuceni;
DELETE FROM recenze;
DELETE FROM pobyt;


-- INITILIZE VALUES

-- insert into uzivatel
INSERT INTO uzivatel VALUES (DEFAULT, 'Jan', 'Novák','100403001', 'Mlynská 12 Praha', '4206969696969');
INSERT INTO uzivatel VALUES (DEFAULT, 'Milan', 'Suchý','9109120009', 'Družstevná 125 Michalovce', '42055555555');
INSERT INTO uzivatel VALUES (DEFAULT, 'Peter', 'Dvořák','7704260080', 'Zimná 444 Bratislava', '421353696787');
INSERT INTO uzivatel VALUES (DEFAULT, 'Igor', 'Mokrý','6408140079', 'Športová 123 Košice', '421747585212');

INSERT INTO uzivatel VALUES (DEFAULT, 'Oleg', 'Starý','520606007', 'Lesná 665 Letanovce', '421555222555');
INSERT INTO uzivatel VALUES (DEFAULT, 'Jerguš', 'Chudobný','420213008', 'Mestská 222 Kežmarok', '421111444777');
INSERT INTO uzivatel VALUES (DEFAULT, 'Ivan', 'Bohatý','340608010', 'Jarná 8 Prešov', '420999666333');
INSERT INTO uzivatel VALUES (DEFAULT, 'Samuel', 'Čierny','8511250154', 'Jarná 8 Prešov', '420111222111');
INSERT INTO uzivatel VALUES (DEFAULT, 'Adam', 'Modrý','9702110253', 'Jesenná 585 Žilina', '421555444212');

--insert into host
INSERT INTO host VALUES (5, DATE '2010-10-10', 0, 'ne' );
INSERT INTO host VALUES (6, DATE '2018-01-06', 2, 'ne' );
INSERT INTO host VALUES (7, DATE '2016-08-26', 5, 'ne' );
INSERT INTO host VALUES (8, DATE '2020-12-23', 2, 'ne' );
INSERT INTO host VALUES (9, DATE '2016-05-17', 10, 'ne' );

--insert into pronajimatel
INSERT INTO pronajimatel VALUES (1, '', 'vyborna', 'minuty');
INSERT INTO pronajimatel VALUES (2, 'kontaktovat skor vopred', 'priemerna', 'hodiny');
INSERT INTO pronajimatel VALUES (3, '', 'nizka', 'dni');
INSERT INTO pronajimatel VALUES (4, '', 'priemerna', 'dni');

--insert into ubytovani
INSERT INTO ubytovani VALUES (DEFAULT, 1, 'dom','15','žiadna', 'Česko','Praha','dlhy popis','izba(2x postel), kuchynka, kuplka','zakaz fajcit vnutri','hasiaci pristroj');
INSERT INTO ubytovani VALUES (DEFAULT, 2, 'chata','50','sezonna', 'Slovensko','Michalovce','kratky popis','izby(3 x 2x postel), kuchynka, kuplka','zakaz fajcit vnutri','hasiaci pristroj, unikove schody');
INSERT INTO ubytovani VALUES (DEFAULT, 3, 'izba','36','žiadna', 'Slovensko','Bratislava','popis','1x postel, WC','zakaz zvierata','');
INSERT INTO ubytovani VALUES (DEFAULT, 4, 'dom','200','dlhodoba', 'Slovensko','Košice','3 poschodovy dom','kuchyna, bazen, wellness','ziadne','hasiaci pristoj, detektor dymu');
INSERT INTO ubytovani VALUES (DEFAULT, 4, 'dom','500','žiadna', 'Slovensko','Margecany','Vila na periferii','kuchyna, bazen, wellness, herna','ziadne','hasiaci pristoj, detektor dymu');

--insert into rezervace 
INSERT INTO rezervace VALUES (DEFAULT, 5, 1, 45, DATE '2021-4-1');
INSERT INTO rezervace VALUES (DEFAULT, 5, 2, 50, DATE '2021-4-1');
INSERT INTO rezervace VALUES (DEFAULT, 6, 5, 50000, DATE '2021-4-2');

--insert into obdobi
INSERT INTO obdobi VALUES (DEFAULT, DATE '2021-4-5', DATE '2021-4-8', 0, 1);

--insert into doporuceni
INSERT INTO doporuceni VALUES (DEFAULT, 1, 'hrad, kastiel, muzeum', 'plavaren', 'Cin-cin, Hradna r.', 'ziadne');

--insert into recenze
INSERT INTO recenze VALUES (DEFAULT, 1, 5, 'vyborne, som uplne spokojny', '10');
INSERT INTO recenze VALUES (DEFAULT, 2, 5, 'priemerne ubytovanie', '8');
INSERT INTO recenze VALUES (DEFAULT, 5, 6, 'za tu cenu to nestoji', '2');

--insert into pobyt
INSERT INTO pobyt VALUES (DEFAULT, 5, 1, DATE '2021-4-5', DATE '2021-4-8', 'kartou', 'ano' );

SELECT * FROM uzivatel;
SELECT * FROM host;
SELECT * FROM pronajimatel;
SELECT * FROM ubytovani;
SELECT * FROM rezervace;
SELECT * FROM obdobi;
SELECT * FROM doporuceni;
SELECT * FROM recenze;
SELECT * FROM pobyt;
